# New in v0.2.50–0.2.55 (CLI v2.1.50–v2.1.55)

> Part of `.agent/claude-agent-sdk.md` docs. See index file for table of contents.

**Release dates**: v2.1.50 (Feb 20), v2.1.51 (Feb 24), v2.1.52–v2.1.55 (Feb 24–25, 2026)

---

## 38. WorktreeCreate / WorktreeRemove Hook Events (v2.1.50)

Two new hook events fire when agent worktree isolation creates or removes worktrees:

```typescript
type WorktreeCreateHookInput = BaseHookInput & {
  hook_event_name: 'WorktreeCreate';
  worktree_path: string;
};

type WorktreeRemoveHookInput = BaseHookInput & {
  hook_event_name: 'WorktreeRemove';
  worktree_path: string;
};
```

Enables custom VCS setup (e.g., installing dependencies, configuring git hooks) when agent worktrees are created, and cleanup when removed.

**Buildd use case**: Set up workspace-specific tooling in worktrees used by skills-as-subagents. Could also track worktree lifecycle for resource cleanup.

---

## 39. Declarative `isolation: worktree` in Agent Definitions (v2.1.50)

Agent definitions now support `isolation: "worktree"` directly in the agent config, making worktree isolation a declarative property rather than requiring runtime configuration:

```typescript
options: {
  agents: {
    'deploy': {
      description: 'Deployment specialist',
      prompt: 'Handle deployments...',
      tools: ['Read', 'Bash', 'Edit', 'Write'],
      model: 'inherit',
      isolation: 'worktree',  // Declarative worktree isolation
    }
  }
}
```

This was previously documented as a v0.2.49 feature (Feature 34) but the actual `isolation` field on agent definitions shipped in v2.1.50.

---

## 40. Account Identity Environment Variables (v2.1.51)

Three new environment variables for SDK callers to provide account info synchronously:

```typescript
options: {
  env: {
    CLAUDE_CODE_ACCOUNT_UUID: 'account-uuid',
    CLAUDE_CODE_USER_EMAIL: 'user@example.com',
    CLAUDE_CODE_ORGANIZATION_UUID: 'org-uuid',
  }
}
```

Eliminates a race condition where early telemetry events lacked account metadata. SDK callers that already have account info can pass it directly.

**Buildd use case**: Workers already have account/workspace info from the claim response. Passing `CLAUDE_CODE_ACCOUNT_UUID` and `CLAUDE_CODE_USER_EMAIL` to the SDK ensures clean telemetry from the first event.

---

## 41. `claude remote-control` Subcommand (v2.1.51)

New CLI subcommand for external builds, enabling local environment serving for all users. Allows external tools to control a running Claude Code session.

---

## 42. `CLAUDE_CODE_DISABLE_1M_CONTEXT` Environment Variable (v2.1.50)

```typescript
options: {
  env: { CLAUDE_CODE_DISABLE_1M_CONTEXT: 'true' }
}
```

Disables 1M context window support. Useful for cost control when extended context isn't needed.

**Buildd use case**: Workspace-level config option to disable extended context for cost-sensitive accounts.

---

## 43. Opus 4.6 Fast Mode with 1M Context (v2.1.50)

Opus 4.6 in fast mode now includes the full 1M context window. Previously, fast mode had a reduced context window.

---

## 44. Tool Result Disk Persistence Threshold (v2.1.51)

Tool results larger than **50K characters** (previously 100K) are now persisted to disk. This reduces context window usage and improves conversation longevity for long-running sessions.

---

## 45. BashTool Login Shell Optimization (v2.1.51)

BashTool now skips the login shell (`-l` flag) by default when a shell snapshot is available. Previously required setting `CLAUDE_BASH_NO_LOGIN=true`. Improves command execution performance.

---

## 46. HTTP Hooks Security Improvements (v2.1.51)

Two security improvements for HTTP hooks:

1. **`allowedEnvVars` required**: Env var interpolation in HTTP hook headers now requires an explicit `allowedEnvVars` list in hook configuration. Previously, arbitrary env vars could be interpolated.

2. **Sandbox routing**: HTTP hooks are now routed through the sandbox network proxy when sandboxing is enabled, enforcing the domain allowlist. Does not apply to `SessionStart`/`Setup` events.

---

## 47. Memory Leak Fixes (v2.1.50)

Multiple critical memory leak fixes for long-running sessions:

| Fix | Impact |
|-----|--------|
| Agent teams: completed teammate tasks garbage collected | Directly fixes unbounded memory growth in agent team sessions |
| File history snapshots capped | Prevents unbounded snapshot accumulation |
| TaskOutput recent lines freed after cleanup | Reduces memory for sessions with many tasks |
| CircularBuffer cleared items released | Fixes backing array retention |
| Shell ChildProcess/AbortController refs released | Fixes retention after command cleanup |
| LSP diagnostic data cleaned up after delivery | Fixes unbounded growth in LSP sessions |
| Completed task output freed from memory | Reduces memory in sessions with many tasks |
| Internal caches cleared after compaction | Improves memory during long sessions |
| Completed task state objects removed from AppState | Fixes AppState memory leak |

**Buildd impact**: Critical for long-running workers. Agent teams memory leak fix is especially relevant since Buildd uses skills-as-subagents extensively.

---

## 48. Headless Mode Startup Performance (v2.1.50)

Improved startup performance for headless mode (`-p` flag) by deferring Yoga WASM and UI component imports. Benefits all Buildd workers since they run in non-interactive mode.

---

## 49. `claude agents` CLI Command (v2.1.50)

New CLI command to list all configured agents:

```bash
claude agents
```

Useful for debugging agent configurations and verifying skill-as-subagent definitions.

---

## 50. Plugin Marketplace Improvements (v2.1.51)

- Default git timeout increased from 30s to 120s
- `CLAUDE_CODE_PLUGIN_GIT_TIMEOUT_MS` env var for custom timeouts
- Support for custom npm registries and specific version pinning when installing plugins from npm sources

---

## 51. Graceful Shutdown & Stability Fixes (v2.1.53)

- Fixed graceful shutdown sometimes leaving stale sessions when using Remote Control
- Fixed `--worktree` sometimes being ignored on first launch
- Bulk agent kill (ctrl+f) now sends single aggregate notification instead of one per agent
- Fixed WASM interpreter crashes on Linux x64 and Windows

**Buildd impact**: Stale session cleanup and aggregate notifications improve worker lifecycle management.

---

## 52. `CLAUDE_CODE_SIMPLE` Mode Enhancements (v2.1.50)

`CLAUDE_CODE_SIMPLE` mode now also disables MCP tools, attachments, hooks, and CLAUDE.md file loading for a fully minimal experience. Useful for lightweight SDK integrations that don't need the full feature set.

---

## v2.1.50–v2.1.55 Performance & Stability Summary

| Version | Key Changes |
|---------|-------------|
| 2.1.50 | Memory leak fixes (9 fixes), headless startup perf, `WorktreeCreate`/`WorktreeRemove` hooks, `claude agents` CLI, `CLAUDE_CODE_DISABLE_1M_CONTEXT`, Opus 4.6 1M fast mode, `CLAUDE_CODE_SIMPLE` enhancements |
| 2.1.51 | `claude remote-control`, account identity env vars, HTTP hooks security, tool result 50K threshold, BashTool login shell skip, plugin npm registries, security fixes for hooks |
| 2.1.52 | VS Code Windows fix |
| 2.1.53 | Graceful shutdown fixes, bulk agent kill aggregate notification, WASM crash fixes |
| 2.1.55 | BashTool Windows EINVAL fix |
