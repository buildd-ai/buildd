<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>buildd</title>
  <link rel="icon" type="image/png" href="/icon.png">
  <link rel="apple-touch-icon" href="/icon.png">
  <link rel="stylesheet" href="/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <!-- Setup screen (shown when not configured) -->
  <div id="setup" class="setup hidden">
    <div class="setup-content">
      <div class="setup-logo">
        <img src="/icon.png" alt="buildd" class="logo-img large">
        <h1>buildd</h1>
      </div>
      <p class="setup-subtitle">Local task runner for AI agents</p>

      <div class="setup-options">
        <a href="/auth/login" class="btn btn-primary btn-large">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
            <polyline points="10 17 15 12 10 7"/>
            <line x1="15" y1="12" x2="3" y2="12"/>
          </svg>
          Login with buildd
        </a>
        <div class="setup-divider">
          <span>or</span>
        </div>
        <button class="btn btn-secondary" id="manualKeyBtn">
          Enter API Key Manually
        </button>
        <div class="setup-divider">
          <span>or</span>
        </div>
        <button class="btn btn-ghost" id="serverlessBtn">
          Use Local Only (no server)
        </button>
      </div>

      <div id="manualKeyForm" class="manual-key-form hidden">
        <div class="form-group">
          <label>API Key</label>
          <input type="password" id="apiKeyInput" class="input" placeholder="bld_xxxxxx...">
        </div>
        <div class="form-actions">
          <button class="btn btn-secondary" id="cancelKeyBtn">Cancel</button>
          <button class="btn btn-primary" id="saveKeyBtn">Save</button>
        </div>
        <p class="setup-hint">Get your API key from the <a href="https://app.buildd.dev" target="_blank">buildd dashboard</a></p>
      </div>

      <p id="setupError" class="setup-error hidden"></p>

      <p class="setup-oss">Built with <a href="https://github.com/anthropics/anthropic-sdk-python/tree/main/src/anthropic/experimental/claude_agent" target="_blank">Claude Agent SDK</a>, <a href="https://bun.sh" target="_blank">Bun</a>, and <a href="https://pusher.com" target="_blank">Pusher</a></p>
    </div>
  </div>

  <div id="app" class="hidden">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <img src="/icon.png" alt="buildd" class="logo-img">
        <span>buildd</span>
      </div>
      <div class="header-actions">
        <button class="btn-icon" id="refreshBtn" title="Refresh">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
            <path d="M21 3v5h-5"/>
          </svg>
        </button>
        <button class="btn-icon" id="addBtn" title="New Task">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
        </button>
        <button class="btn-icon" id="settingsBtn" title="Settings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Main content -->
    <main class="main">
      <!-- Workers section -->
      <section class="section">
        <h2 class="section-title">Active</h2>
        <div id="workers" class="worker-list"></div>
      </section>

      <!-- Completed workers section -->
      <section class="section" id="completedSection">
        <div id="completed"></div>
      </section>

      <!-- Tasks section -->
      <section class="section">
        <h2 class="section-title">Pending Tasks</h2>
        <div id="tasks" class="task-list"></div>
      </section>
    </main>

    <!-- Worker detail modal -->
    <div id="workerModal" class="modal hidden">
      <div class="modal-content">
        <header class="modal-header">
          <button class="btn-icon" id="modalBack">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
          </button>
          <h2 id="modalTitle">Worker</h2>
          <button class="btn-icon btn-danger" id="modalAbort">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
            </svg>
          </button>
        </header>
        <div class="modal-body">
          <div class="worker-meta" id="modalMeta"></div>
          <div class="worker-description" id="modalDescription"></div>
          <div class="chat-timeline" id="chatTimeline"></div>
        </div>
        <div class="modal-input">
          <input type="text" id="messageInput" class="input" placeholder="Send a message to the agent...">
          <button class="btn btn-primary" id="sendMessageBtn">Send</button>
        </div>
        <footer class="modal-footer">
          <button class="btn btn-secondary" id="modalAbortBtn">Abort</button>
          <button class="btn btn-primary" id="modalDoneBtn">Mark Done</button>
        </footer>
      </div>
    </div>

    <!-- New task modal -->
    <div id="taskModal" class="modal hidden">
      <div class="modal-content">
        <header class="modal-header">
          <button class="btn-icon" id="taskModalBack">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
          </button>
          <h2>New Task</h2>
          <div></div>
        </header>
        <div class="modal-body">
          <div class="form-group">
            <label>Workspace</label>
            <div class="workspace-select-row">
              <div class="custom-select flex-1" id="workspaceSelect">
                <button type="button" class="custom-select-trigger" id="workspaceSelectTrigger">
                  <span class="custom-select-value">Select workspace...</span>
                  <svg class="custom-select-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <polyline points="6 9 12 15 18 9"/>
                  </svg>
                </button>
                <div class="custom-select-dropdown hidden" id="workspaceSelectDropdown">
                  <div class="custom-select-options" id="workspaceSelectOptions"></div>
                </div>
              </div>
              <button type="button" class="btn btn-secondary btn-icon-text" id="manageWorkspacesBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
                </svg>
                Manage
              </button>
            </div>
            <p id="workspaceHint" class="form-hint hidden"></p>
            <input type="hidden" id="taskWorkspace" value="">
          </div>
          <div class="form-group">
            <label>Title</label>
            <input type="text" id="taskTitle" class="input" placeholder="Fix the bug...">
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea id="taskDescription" class="input textarea" placeholder="Describe the task..."></textarea>
          </div>
          <div class="form-group">
            <label>Attachments</label>
            <div class="attachments" id="attachments">
              <label class="attachment-add">
                <input type="file" id="fileInput" accept="image/*" multiple hidden>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
              </label>
            </div>
          </div>
        </div>
        <footer class="modal-footer">
          <button class="btn btn-secondary" id="taskModalCancel">Cancel</button>
          <button class="btn btn-primary" id="taskModalCreate">Create Task</button>
        </footer>
      </div>
    </div>

    <!-- Settings modal -->
    <div id="settingsModal" class="modal hidden">
      <div class="modal-content">
        <header class="modal-header">
          <button class="btn-icon" id="settingsModalBack">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
          </button>
          <h2>Settings</h2>
          <div></div>
        </header>
        <div class="modal-body">
          <div class="form-group">
            <label>Projects Root</label>
            <input type="text" id="settingsRoot" class="input" readonly>
          </div>
          <div class="form-group">
            <label>buildd Server</label>
            <input type="text" id="settingsServer" class="input" readonly>
          </div>
          <div class="form-group">
            <label>Model</label>
            <select id="settingsModel" class="input">
              <option value="claude-opus-4-5-20251101">Claude Opus 4.5 (Best quality)</option>
              <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5 (Fast & capable)</option>
              <option value="claude-haiku-4-20250514">Claude Haiku 4 (Fastest)</option>
            </select>
            <p class="form-hint">New workers will use the selected model</p>
          </div>
          <div class="form-group">
            <label>Max Concurrent</label>
            <div class="btn-group" id="settingsMax"></div>
          </div>
          <div class="form-group">
            <div class="flex items-center gap-2">
              <input type="checkbox" id="settingsAcceptRemote" checked>
              <label for="settingsAcceptRemote">Accept remote task assignments</label>
            </div>
            <p class="form-hint">Allow the dashboard to push tasks directly to this worker</p>
          </div>
          <div class="form-group">
            <div class="flex items-center gap-2">
              <input type="checkbox" id="settingsBypass">
              <label for="settingsBypass">Bypass permission prompts</label>
            </div>
            <p class="form-hint">Allow agents to run bash commands without approval. Dangerous commands (sudo, rm -rf /, etc.) are always blocked.</p>
          </div>
          <div class="form-group">
            <div class="flex items-center gap-2">
              <input type="checkbox" id="settingsOpenBrowser" checked>
              <label for="settingsOpenBrowser">Auto-open browser on startup</label>
            </div>
            <p class="form-hint">Automatically open the buildd UI in your browser when starting the server.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Workspace management modal -->
    <div id="workspaceModal" class="modal hidden">
      <div class="modal-content modal-large">
        <header class="modal-header">
          <button class="btn-icon" id="workspaceModalBack">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
          </button>
          <h2>Manage Workspaces</h2>
          <button class="btn btn-secondary btn-icon-text" id="rescanBtn" title="Rescan local repositories">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
              <path d="M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
              <path d="M21 3v5h-5"/>
            </svg>
            Rescan
          </button>
        </header>
        <div class="modal-body">
          <div class="workspace-sections">
            <section class="workspace-section">
              <h3 class="section-label">
                <span class="status-dot status-ready"></span>
                Ready to Use
              </h3>
              <div id="workspacesReady" class="workspace-list"></div>
            </section>

            <section class="workspace-section">
              <h3 class="section-label">
                <span class="status-dot status-clone"></span>
                Needs Clone
              </h3>
              <div id="workspacesNeedsClone" class="workspace-list"></div>
            </section>

            <section class="workspace-section">
              <h3 class="section-label">
                <span class="status-dot status-local"></span>
                Local Only
              </h3>
              <p class="section-hint">These repos can be synced to buildd server</p>
              <div id="workspacesLocalOnly" class="workspace-list"></div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="/app.js"></script>
</body>
</html>
